<div class="page page-ui-notifications">
    <ol class="breadcrumb breadcrumb-small">
        <li>Marketplace</li>
        <li class="active"><a ui-sref="root.myOrganizations">My Organizations</a></li>
        <li class="active"><a ui-sref="root.market-dash({orgId: orgScreenModel.organization.id})">{{orgScreenModel.organization.name}}</a></li>
    </ol>
    <div class="toast toast-bottomRight">
        <alert ng-repeat="toast in toasts" type="{{toast.type}}" close="closeAlert($index)" class="toast-fade">
            <div ng-bind-html="toast.msg">Test Toast</div>
        </alert>
    </div>
    <div class="row">

        <div class="col-sm-10 col-sm-offset-1">
            <div class="panel panel-primary">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-sm-6 text-primary">
                            <h4><i class="fa fa-cogs"></i>
                                {{orgScreenModel.organization.name}} {{$state.is('root.market-dash.members') ? 'Members' : 'Applications'}} Overview
                            </h4>
                        </div>
                        <div class="col-sm-6">
                            <div class="pull-right">
                                <button class="btn btn-line-default" ui-sref="root.market-dash.members" ng-class="{'hidden': $state.is('root.market-dash.members')}">Members</button>
                                <button class="btn btn-line-default" ui-sref="root.market-dash" ng-class="{'hidden': $state.is('root.market-dash')}">Applications</button>
                                <button class="btn btn-line-primary" ng-click="modalNewApplication()" ng-if="User.isAuthorizedFor('appEdit')">New Application</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-12 mt10">
                <div class="row">
                    <div class="panel panel-default">
                        <div class="panel-body" ui-view>

                            <!-- Applications Tab Content -->
                            <div class="col-sm-12">
                                <form role="form" class="form-horizontal">
                                    <div class="form-group">
                                        <div class="col-sm-4">
                                            <div class="input-group">
                                                <input type="text" class="form-control" ng-model="searchText" placeholder="Filter by application name...">
                                                <div class="input-group-btn">
                                                    <button class="btn btn-default btn-sm fa fa-search"></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                                <hr>
                            </div>
                            <!-- The list of applications in the org -->

                            <div class="col-sm-12" ng-hide="applications.length > 0">
                                <div class="row">
                                    <div class="col-sm-8 col-sm-offset-1 well">
                                        It looks like there you have not yet created any applications! Now might be a good time to click the New App button up above...
                                    </div>
                                    <div class="col-sm-3">
                                        <div class="no-entities-arrow"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-12" ng-show="applications.length > 0 && (applications | filter:{name:searchText}).length == 0">
                                <div class="row">
                                    <div class="col-sm-10 col-sm-offset-1 well">
                                        No applications found matching your filter criteria - please try searching for something different.
                                    </div>
                                </div>
                            </div>


                            <div class="col-sm-12 mt10 table-responsive" ng-hide="applications.length === 0 || (applications | filter:{name:searchText}).length === 0" style="overflow: visible">
                                <p><a class="clickable" ng-click="expandAll()">Expand all</a> / <a class="clickable" ng-click="collapseAll()">Collapse all</a></p>
                                <table class="table table-bordered table-condensed">
                                    <thead>
                                    <tr>
                                        <th nowrap="nowrap" width="5%"></th>
                                        <th nowrap="nowrap" width="45%">Application</th>
                                        <th nowrap="nowrap" width="10%">Version</th>
                                        <th nowrap="nowrap" width="15%">Status</th>
                                        <th nowrap="nowrap" width="10%"># Contracts</th>
                                        <th nowrap="nowrap" width="15%">Actions</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat-start="application in applications | filter:{name:searchText}">
                                        <td><a class="clickable fa fa-fw" tooltip-popup-delay="300" tooltip-placement="top" tooltip="Contract details" ng-class="{'fa-chevron-down': application.contractsExpanded, 'fa-chevron-right': !application.contractsExpanded}" ng-show="applicationContracts.hasOwnProperty(application.id)" ng-click="toggle(application)"></a></td>
                                        <td>
                                            <base64-logo logo-class="mini-logo" logo="{{application.base64logo}}"></base64-logo>&nbsp;&nbsp;
                                            <a ui-sref="root.application({orgId: application.organizationId, appId: application.id, versionId: applicationVersions[application.id].version})">{{application.name}}</a>
                                        </td>
                                        <td>{{applicationVersions[application.id].version}}</td>
                                        <td><status-label status="{{applicationVersions[application.id].status}}"></status-label></td>
                                        <td>{{applicationContracts.hasOwnProperty(application.id) ? applicationContracts[application.id].length : 0}}</td>
                                        <td>
                                            <div class="btn-group-xs">
                                                <button class="btn btn-primary action-icon fa fa-plus" tooltip-popup-delay="300" tooltip-placement="top" tooltip="New contract" ng-if="canCreateContract(applicationVersions[application.id]) && User.isAuthorizedFor('appEdit')" ng-click="newContract(applicationVersions[application.id])"></button>
                                                <button class="btn btn-success action-icon fa fa-check" tooltip-popup-delay="300" tooltip-placement="top" tooltip="Register application" ng-if="canPublish(applicationVersions[application.id]) && User.isAuthorizedFor('appEdit')" ng-click="confirmPublishApp(applicationVersions[application.id])"></button>
                                                <button class="btn btn-warning action-icon fa fa-trash" tooltip-popup-delay="300"  tooltip-placement="top" tooltip="Retire application" ng-if="canRetire(applicationVersions[application.id]) && User.isAuthorizedFor('appEdit')" ng-click="confirmRetireApp(applicationVersions[application.id])"></button>
                                                <button class="btn btn-info action-icon fa fa-pie-chart" tooltip-popup-delay="300" tooltip-placement="top" tooltip="Application metrics" ng-if="canRetire(applicationVersions[application.id]) && User.isAuthorizedFor('appEdit')" ng-click="toMetrics(applicationVersions[application.id])"></button>
                                                <button class="btn btn-info action-icon fa fa-lock" tooltip-popup-delay="300" tooltip-placement="top" tooltip="OAuth 2.0 configuration" ng-if="canConfigureOAuth(applicationVersions[application.id]) && User.isAuthorizedFor('appEdit')" ng-click="showOAuthConfig(applicationVersions[application.id])"></button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr ng-show="application.contractsExpanded" class="row-selected fadein" ng-repeat-end>
                                        <td></td>
                                        <td colspan="5">
                                            <table class="table table-condensed row-selected">
                                                <thead>
                                                <tr>
                                                    <th nowrap="nowrap" width="5%">#</th>
                                                    <th nowrap="nowrap" width="40%">To Service</th>
                                                    <th nowrap="nowrap" width="40%">Using Plan</th>
                                                    <th nowrap="nowrap" width="15%">Actions</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr ng-repeat="contract in applicationContracts[application.id]">
                                                    <td>{{$index+1}}</td>
                                                    <td><a href ng-click="toApiDoc(contract)">{{contract.serviceName}} - {{contract.serviceVersion}}</a></td>
                                                    <td>{{contract.planName}} - {{contract.planVersion}}</td>
                                                    <td>
                                                        <button clipboard text="contract.apikey" on-copied="toastService.timedClose()" class="btn btn-line-default btn-xs action-icon fa fa-key" ng-click="copyKey(contract.apikey)" tooltip-popup-delay="300" tooltip-placement="top" tooltip="Copy API key to clipboard" ng-show="isNotRetired(applicationVersions[application.id]) && User.isAuthorizedFor('appEdit')"></button>
                                                        <button clipboard text="contract.provisionKey" on-copied="toastService.timedClose()" class="btn btn-line-default btn-xs action-icon fa fa-lock" ng-click="copyProvisionKey(contract.provisionKey)" tooltip-popup-delay="300" tooltip-placement="top" tooltip="Copy OAuth Provision key" ng-show="canConfigureOAuth(applicationVersions[application.id]) && User.isAuthorizedFor('appEdit')"></button>
                                                        <button class="btn btn-warning btn-xs action-icon fa fa-ban" tooltip-popup-delay="300" tooltip-placement="top" tooltip="Break contract" ng-if="canPublish(applicationVersions[application.id]) && User.isAuthorizedFor('appEdit')" ng-click="breakContract(contract)"></button>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <alert ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)">
                                <div ng-bind-html="alert.msg"></div>
                            </alert>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
